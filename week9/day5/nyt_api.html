<!doctype html>
<html lang="en">
    <head>
        <title>New York Times api exercise</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="navigation"><a href="addpost.html">main - create new post</a></div>
        <div class="line1"></div>
        <div class="line2"></div>
        <script>
            'use strict';

            var http = new XMLHttpRequest();
            var score = 0;
            var navigation = document.querySelector('.navigation');

            var finedate = Date.now();

            http.onreadystatechange = function() {
                if (http.readyState === 4 && http.status === 200) {
                    var fullDataArray = JSON.parse(http.response);
                    console.log(fullDataArray);

                    var posts = fullDataArray.posts.length;

                    for (let i = 0; i < posts; i++) {

                        var timecalc = Math.floor((finedate - fullDataArray.posts[i].timestamp) / 60000);

                        var onepost = document.createElement('div');
                        document.body.appendChild(onepost);
                        onepost.setAttribute('class', 'onepost');

                        var number = document.createElement('div');
                        onepost.appendChild(number);
                        number.innerHTML = (i + 1);
                        number.setAttribute('class', 'number');

                        var arrowcontainer = document.createElement('div');
                        onepost.appendChild(arrowcontainer);
                        arrowcontainer.setAttribute('class', 'arrowcontainer');

                        var upvote = document.createElement('div');
                        arrowcontainer.appendChild(upvote);
                        upvote.setAttribute('class', 'upvote');
                        upvote.addEventListener('click', voteplus);

                        var votes = document.createElement('div');
                        arrowcontainer.appendChild(votes);
                        votes.innerHTML = 0;
                        votes.setAttribute('class', 'votes');

                        var downvote = document.createElement('div');
                        arrowcontainer.appendChild(downvote);
                        downvote.setAttribute('class', 'downvote');
                        downvote.addEventListener('click', voteminus);

                        var textcontainer = document.createElement('div');
                        onepost.appendChild(textcontainer);
                        textcontainer.setAttribute('class', 'textcontainer');

                        var header = document.createElement('a');
                        textcontainer.appendChild(header);
                        header.innerHTML = fullDataArray.posts[i].title;
                        header.setAttribute('class', 'header');
                        header.setAttribute('href', fullDataArray.posts[i].href);

                        var submitdata = document.createElement('div');
                        textcontainer.appendChild(submitdata);
                        submitdata.innerHTML = 'submitted ' + timecalc + ' minutes ago by anonymous';
                        submitdata.setAttribute('class', 'submitdata');

                        var modrem = document.createElement('div');
                        textcontainer.appendChild(modrem);
                        modrem.setAttribute('class', 'modrem');

                        var modify = document.createElement('div');
                        modrem.appendChild(modify);
                        modify.innerHTML = 'modify';
                        modify.setAttribute('class', 'modify');

                        var remove = document.createElement('div');
                        modrem.appendChild(remove);
                        remove.innerHTML = 'remove';
                        remove.setAttribute('class', 'remove');
                    }

                    function voteplus (e) {
                        let onclick = e.target.parentNode.querySelector('.votes');
                        score = onclick.innerHTML;
                        score++;
                        onclick.innerHTML = score;

                        let colorChangeArrow = e.target.parentNode.querySelector('.upvote');
                        colorChangeArrow.setAttribute('class', 'upvoteclicked');
                        setTimeout(function(){ colorChangeArrow.setAttribute('class', 'upvote'); }, 1000);

                        let colorChangeNumber = e.target.parentNode.querySelector('.votes');
                        colorChangeNumber.setAttribute('class', 'colorchangenumber');
                        setTimeout(function(){ colorChangeNumber.setAttribute('class', 'votes'); }, 1000);
                    }

                    function voteminus (e) {
                        let onclick = e.target.parentNode.querySelector('.votes');
                        score = onclick.innerHTML;
                        if (score > 0){
                            score--;
                            onclick.innerHTML = score;

                            let colorChangeArrow = e.target.parentNode.querySelector('.downvote');
                            colorChangeArrow.setAttribute('class', 'downvoteclicked');
                            setTimeout(function(){ colorChangeArrow.setAttribute('class', 'downvote'); }, 1000);

                            let colorChangeNumber = e.target.parentNode.querySelector('.votes');
                            colorChangeNumber.setAttribute('class', 'colorchangenumberdown');
                            setTimeout(function(){ colorChangeNumber.setAttribute('class', 'votes'); }, 1000);
                        }
                    }
                }
            }

            http.open('GET', 'https://time-radish.glitch.me/posts');
            http.setRequestHeader('Accept', 'application/json');
            http.send();

        </script>
    </body>
</html>
